"use strict";var format=require("./format"),i18n=require("./i18n");module.exports=function(e){function r(e,r){var a=0;return Math.abs(.5-e.percentage)>Math.abs(.5-r.percentage)&&(a=-1),Math.abs(.5-e.percentage)<Math.abs(.5-r.percentage)&&(a=1),a}function a(e,r){var a=0;return Math.abs(e.percentage)>Math.abs(r.percentage)&&(a=-1),Math.abs(e.percentage)<Math.abs(r.percentage)&&(a=1),a}function t(e,r,a){var t=[e,r].sort(function(e,r){var a="EANOC".indexOf(e.id.charAt(0)),t="EANOC".indexOf(r.id.charAt(0));return t>a?-1:1}),n=t[0].id.concat(t[0].percentage>.5?"_plus_":"_minus_").concat(t[1].id).concat(t[1].percentage>.5?"_plus":"_minus"),o=l.circumplexData[n][0],s="%s";if(o.perceived_negatively)switch(a){case 0:s=g("a bit %s");break;case 1:s=g("somewhat %s");break;case 2:s=g("can be perceived as %s")}return format(s,o.word)}function n(e){var r,a,t=l.facetsData[e.id.replace("_","-").replace(" ","-")];return e.percentage>.5?(r=t.HighTerm.toLowerCase(),a=t.HighDescription.toLowerCase()):(r=t.LowTerm.toLowerCase(),a=t.LowDescription.toLowerCase()),{name:e.id,term:r,description:a}}function o(e){return Math.min(Math.floor(4*e),3)}function s(e){var r=l.valuesData[e.id.replace(/[_ ]/g,"-")][0],a=e.percentage>.5?r.HighDescription:r.LowDescription;return{name:e.id,term:r.Term.toLowerCase(),description:a}}function c(e){var r=l.needsData[e.id];return r}function i(e){var a,n,o,s,c,i=[],u=[];switch(e.children[0].children.forEach(function(e){u.push({id:e.id,percentage:e.percentage})}),u.sort(r),a=u.filter(function(e){return Math.abs(.5-e.percentage)>.18}),a.length<2&&(a=[u[0],u[1]]),a.length){case 2:n=t(a[0],a[1],0),i.push(format(g("You are %s"),n)+".");break;case 3:o=t(a[0],a[1],0),s=t(a[1],a[2],1),i.push(format(g("You are %s and %s"),o,s)+".");break;case 4:case 5:o=t(a[0],a[1],0),s=t(a[1],a[2],1),c=t(a[2],a[3],2),i.push(format(g("You are %s, %s and %s"),o,s,c)+".")}return i}function u(e){var a,t,o=[],s=[];if(e.children[0].children.forEach(function(e){e.children.forEach(function(r){s.push({id:r.id,percentage:r.percentage,parent:e})})}),s.sort(r),a=n(s[0]),o.push(format(g("You are %s"),a.term)+": "+a.description+"."),a=n(s[1]),o.push(format(g("You are %s"),a.term)+": "+a.description+"."),t=2,s[0].parent===s[1].parent)for(;s[0].parent===s[t].parent;)t+=1;return a=n(s[t]),o.push(format(g("And you are %s"),a.term)+": "+a.description+"."),o}function p(e){var a,t,n,c,i,u,p,h,d=[],f=[];if(e.children[0].children.forEach(function(e){f.push({id:e.id,percentage:e.percentage})}),f.sort(r),a=o(f[0].percentage)===o(f[1].percentage),t=s(f[0]),n=s(f[1]),a){switch(p=t.term,h=n.term,o(f[0].percentage)){case 0:c=format(g("You are relatively unconcerned with both %s and %s"),p,h)+".";break;case 1:c=format(g("You don't find either %s or %s to be particularly motivating for you"),p,h)+".";break;case 2:c=format(g("You value both %s and %s a bit"),p,h)+".";break;case 3:c=format(g("You consider both %s and %s to guide a large part of what you do"),p,h)+"."}d.push(c),d.push(t.description+"."),d.push(format(g("And %s"),n.description.toLowerCase())+".")}else for(i=[t,n],u=0;u<i.length;u+=1){switch(o(f[u].percentage)){case 0:c=format(g("You are relatively unconcerned with %s"),i[u].term);break;case 1:c=format(g("You don't find %s to be particularly motivating for you"),i[u].term);break;case 2:c=format(g("You value %s a bit more"),i[u].term);break;case 3:c=format(g("You consider %s to guide a large part of what you do"),i[u].term)}c=c.concat(": ").concat(i[u].description.toLowerCase()).concat("."),d.push(c)}return d}function h(e){var r,t,n=[],s=[];switch(e.children[0].children.forEach(function(e){s.push({id:e.id,percentage:e.percentage})}),s.sort(a),r=c(s[0])[0],o(s[0].percentage)){case 0:t=g("Experiences that make you feel high %s are generally unappealing to you");break;case 1:t=g("Experiences that give a sense of %s hold some appeal to you");break;case 2:t=g("You are motivated to seek out experiences that provide a strong feeling of %s");break;case 3:t=g("Your choices are driven by a desire for %s")}return t=format(t,r).concat("."),n.push(t),n}function d(e){return[i(e.children[0]),u(e.children[0]),h(e.children[1]),p(e.children[2])]}function f(e){return d(e.tree).map(function(e){return e.join(" ")}).join("\n")}var l={},m=i18n.getDictionary(e),g=i18n.translatorFactory.createTranslator(m.phrases);return l.circumplexData=m.traits,l.facetsData=m.facets,l.valuesData=m.values,l.needsData=m.needs,l.assembleTraits=i,l.assembleFacets=u,l.assembleNeeds=h,l.assembleValues=p,l.assemble=d,l.getSummary=f,l};